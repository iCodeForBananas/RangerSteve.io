!function t(e,i,o){function h(s,a){if(!i[s]){if(!e[s]){var n="function"==typeof require&&require;if(!a&&n)return n(s,!0);if(l)return l(s,!0);var r=new Error("Cannot find module '"+s+"'");throw r.code="MODULE_NOT_FOUND",r}var d=i[s]={exports:{}};e[s][0].call(d.exports,function(t){var i=e[s][1][t];return h(i?i:t)},d,d.exports,t,e,i,o)}return i[s].exports}for(var l="function"==typeof require&&require,s=0;s<o.length;s++)h(o[s]);return h}({1:[function(t,e,i){"use strict";function o(){var t=0;for(var e in y.blocks)y.blockInt[e]=t,y.blockColor[t]=y.blocks[e],t++;for(y.state="loading",this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),y.horizon=y.levelHeight/2|0,t=0;t<y.handlers.length;t++){var i=y.handlers[t]+"Handler",o=i.charAt(0).toUpperCase()+i.slice(1);this[i]=new window[o](this)}setInterval(this.enterFrame.bind(this),1e3/60),new c(this)}function h(t){this.size=8,this.startHp=30,this.list=[],this.pool=[]}function l(t){this.a=!1,this.d=!1,this.s=!1,this.space=!1,this.mouseLeft=!1,this.mouseRight=!1,this.mouseX=0,this.mouseY=0,this.main=t,this.canvas=t.canvas,window.addEventListener("keydown",this.keyDownEvent.bind(this)),window.addEventListener("keyup",this.keyUpEvent.bind(this)),window.addEventListener("mousedown",this.mouseDownEvent.bind(this)),window.addEventListener("mouseup",this.mouseUpEvent.bind(this)),window.addEventListener("mousemove",this.mouseMoveEvent.bind(this)),window.addEventListener("mousewheel",this.mouseWheelEvent.bind(this)),window.addEventListener("DOMMouseScroll",this.mouseWheelEvent.bind(this)),document.getElementById("canvas").addEventListener("contextmenu",function(t){return 2==t.button?(t.preventDefault(),!1):void 0})}function s(t){var e,i,o=.75,h=t.gridHandler.list,l=t.gridHandler.waterList,s=y.horizon;for(e=0;e<y.levelWidth/20;e++){var a=Math.random()*(y.levelWidth-20)+10|0,n=Math.random()*(.5*y.levelHeight-20)+8|0;for(i=0;25>i;i++)for(var r=0;9>r;r++)h[a+Math.random()*r*2-r|0][n+Math.random()*r-r/2|0]=y.blockInt.cloud}for(e=0;e<y.levelWidth;e++)if(0!=e&&e!=y.levelWidth-1){if(h[e][0]=y.blockInt.bedrock,h[e][y.levelHeight-1]=y.blockInt.bedrock,s>y.horizon)for(i=y.horizon;s>i;i++)h[e][i]=y.blockInt.water,l[l.length]={x:e,y:i};for(i=s;i<y.levelHeight-1;i++)i>s+8*Math.random()+4?h[e][i]=y.blockInt.stone:h[e][i]=y.blockInt.dirt;Math.random()<o&&(s+=(3*Math.random()|0)-1),s>y.horizon&&e>y.levelWidth/2-20&&e<y.levelWidth/2&&s--,s>y.levelHeight-1?s--:1>s&&s++}else for(i=0;i<y.levelHeight;i++)h[e][i]=y.blockInt.bedrock;for(e=0;e<y.levelWidth/25;e++){var a=Math.random()*(y.levelWidth-20)+10|0,n=y.horizon+Math.random()*(.5*y.levelHeight-20)+8|0;for(i=0;25>i;i++)for(var r=8*Math.random()|0;r>=0;r--){var d=a+Math.random()*r*2-r|0,s=n+Math.random()*r-r/2|0;h[d][s]=!1}}for(e=0;e<y.levelWidth/25;e++){var a=Math.random()*(y.levelWidth-20)+10|0,n=y.horizon+Math.random()*(.5*y.levelHeight-20)+8|0;for(i=0;25>i;i++)for(var r=8*Math.random()|0;r>=0;r--){var d=a+Math.random()*r*2-r|0,s=n+Math.random()*r-r/2|0;h[d][s]=y.blockInt.water,l[l.length]={x:d,y:s}}}}function a(t){this.size=6,this.startHp=30,this.list=[],this.pool=[]}function n(t){this.startAccel=.01,this.startSpeed=.5,this.fallSpeed=4,this.startWidth=18,this.startHeight=23,this.jumpHeight=6,this.jumpDelay=12,this.startHp=8,this.spawnRate=.01,this.list=[],this.pool=[]}function r(t){y.state="gameOverScreen",t.controlHandler.mouseLeft=!1,t.context.clearRect(0,0,t.canvas.width,t.canvas.height);var e=.5*t.canvas.width,i=.5*t.canvas.height,o="rgba(0,0,0,0.9)",h="rgba(0,0,0,0.5)",l="rgba(0,0,0,0.3)";new m(t.context,"Ranger Steve: Buffalo Invasion",9,18,"normal 21px/1 "+y.fontFamily,l,"left"),new m(t.context,"Game Over!",e,i-70,"normal 22px/1 "+y.fontFamily,o),new m(t.context,"Kills:"+t.playerHandler.kills,e,i-30,"normal 16px/1 "+y.fontFamily,h),new m(t.context,"Click to Restart",e,i+10,"normal 17px/1 "+y.fontFamily,o)}function d(t){}function c(t){y.state="menuScreen",t.controlHandler.mouseLeft=!1,t.context.clearRect(0,0,t.canvas.width,t.canvas.height);var e=.5*t.canvas.width,i=.5*t.canvas.height,o="rgba(0,0,0,0.9)",h="rgba(0,0,0,0.5)",l="rgba(0,0,0,0.3)";new m(t.context,"Ranger Steve: Buffalo Invasion",9,18,"normal 21px/1 "+y.fontFamily,l,"left"),new m(t.context,"Click to Start",e,i-70,"normal 17px/1 "+y.fontFamily,o),new m(t.context,'Use "A" and "D" to move and "Space" to jump.',e,i-30,"normal 15px/1 "+y.fontFamily,h),new m(t.context,"Use mouse wheel to change action and left click to perform action.",e,i-10,"normal 15px/1 "+y.fontFamily,h),new m(t.context,"You can build and destroy terrain.",e,i+10,"normal 15px/1 "+y.fontFamily,h),new m(t.context,"Enemies come out at night.",e,i+30,"normal 15px/1 "+y.fontFamily,h)}function p(t){this.accel=.3,this.speed=2.5,this.fallSpeed=8,this.width=20,this.height=25,this.startHp=100,this.regen=.01,this.jumpHeight=7,this.jumpDelay=4,this.actions=[{name:"Shotgun",reload:25,count:4,speed:7,hp:180,modY:.01,explode:0,spread:.5,damage:1,destroy:!1},{name:"Rifle",reload:6,count:1,speed:8,hp:90,modY:.01,explode:0,spread:.2,damage:1,destroy:!1},{name:"Grenade",reload:50,count:1,speed:5,hp:360,modY:.1,explode:1,spread:.5,damage:2,destroy:!0},{name:"Flamer",reload:1,count:1,speed:7,hp:20,modY:-.1,explode:0,spread:1.5,damage:.15,destroy:!1},{name:"Bomb",reload:85,count:1,speed:4.5,hp:480,modY:.15,explode:2,spread:.3,damage:3,destroy:!0},{name:"Rocket",reload:90,count:4,speed:8,hp:240,modY:0,explode:1,spread:.05,damage:2,destroy:!0},{name:"Build Dirt",reload:4,count:-1,type:y.blockInt.dirt},{name:"Build Stone",reload:8,count:-1,type:y.blockInt.stone},{name:"Build Wood",reload:6,count:-1,type:y.blockInt.wood},{name:"Build Platform",reload:6,count:-1,type:y.blockInt.platform},{name:"Remove Block",reload:29,count:-2}],this.kills,this.action,this.actionObject,this.canBuild}function v(t){this.sunMoonArcRadius=t.canvas.height-40,this.main=t,this.canvas=t.canvas,this.context=t.context,this.timeRatio=2*Math.PI/y.dayLength}function f(t){this.size=5,this.actions=[!1,{name:"Explode1",count:30,speed:4,hp:15,modY:0,explode:0,spread:0,damage:1,destroy:!1},{name:"Explode2",count:30,speed:4,hp:15,modY:0,explode:0,spread:0,damage:2,destroy:!0}],this.list=[],this.pool=[]}function m(t,e,i,o,h,l,s,a){t.font="undefined"==typeof h?"normal 16px/1 Arial":h,t.fillStyle="undefined"==typeof l?"#000000":l,t.textAlign="undefined"==typeof s?"center":s,t.textBaseline="undefined"==typeof a?"middle":a,t.fillText(e,i,o)}function u(t){this.x,this.y}var y={blockSize:16,levelWidth:500,levelHeight:100,handlers:["control","grid","render","player","enemy","shot","dust","blood","view"],horizon:null,fontFamily:'"Segoe UI",Arial,sans-serif',dayLength:28800,blocks:{bedrock:"#363532",dirt:"#AE9A73",stone:"#807E79",wood:"#9F763B",water:"rgba(0,72,151,0.5)",cloud:"rgba(255,255,255,0.7)",platform:"#9F763B"},blockInt:{},blockColor:[],state:"loading",time:0};window.onload=function(){new o},o.prototype.startGame=function(){for(var t=0;t<y.handlers.length;t++)this[y.handlers[t]+"Handler"].init(this);new s(this),y.state="game",y.time=.37*y.dayLength},o.prototype.enterFrame=function(){if("game"==y.state){if(this.playerHandler.hp<=0)return y.state="gameOverScreen",void new r(this);y.time++,y.time>y.dayLength&&(y.time=0);for(var t=0;t<y.handlers.length;t++)this[y.handlers[t]+"Handler"].enterFrame()}},h.prototype.init=function(t){this.list.length=0,this.gridList=t.gridHandler.list},h.prototype.enterFrame=function(){for(var t,e,i,o=this.gridList,h=this.list.length-1;h>=0;h--)t=this.list[h],t.x+=t.vX,t.y+=t.vY,t.vY+=.2,t.hp--,e=t.x/y.blockSize|0,i=t.y/y.blockSize|0,e>=0&&e<y.levelWidth&&i>=0&&i<y.levelHeight&&(o[e][i]==y.blockInt.water?(t.x-=.5*t.vX,t.y-=.5*t.vY):o[e][i]!==!1&&o[e][i]!=y.blockInt.cloud&&o[e][i]!=y.blockInt.platform&&(t.hp*=.75)),t.hp<=0&&(this.pool[this.pool.length]=t,this.list.splice(h,1))},h.prototype.create=function(t,e,i,o,h){for(var l=0;h>l;l++){if(this.pool.length>0)var s=this.pool.pop();else var s=new Object;s.x=t,s.y=e,s.vX=i+6*Math.random()-3,s.vY=o+6*Math.random()-3,s.hp=this.startHp,this.list[this.list.length]=s}},l.prototype.init=function(t){this.playerHandler=t.playerHandler},l.prototype.enterFrame=function(){},l.prototype.keyDownEvent=function(t){return 32==t.keyCode?this.space=!0:65==t.keyCode?this.a=!0:68==t.keyCode?this.d=!0:83==t.keyCode?this.s=!0:(t.keyCode>=48||t.keyCode<=57)&&"game"==y.state&&this.playerHandler.hotKey(t.keyCode),this.mouseX>0&&this.mouseX<this.canvas.width&&this.mouseY>0&&this.mouseY<this.canvas.height?(t.preventDefault(),!1):void 0},l.prototype.keyUpEvent=function(t){return 32==t.keyCode?this.space=!1:65==t.keyCode?this.a=!1:68==t.keyCode?this.d=!1:83==t.keyCode&&(this.s=!1),this.mouseX>0&&this.mouseX<this.canvas.width&&this.mouseY>0&&this.mouseY<this.canvas.height?(t.preventDefault(),!1):void 0},l.prototype.mouseDownEvent=function(t){0==t.button?this.mouseLeft=!0:2==t.button&&(this.mouseRight=!0)},l.prototype.mouseUpEvent=function(t){this.mouseLeft&&this.mouseX>0&&this.mouseX<this.canvas.width&&this.mouseY>0&&this.mouseY<this.canvas.height&&("menuScreen"!=y.state&&"gameOverScreen"!=y.state||this.main.startGame()),0==t.button?this.mouseLeft=!1:2==t.button&&(this.mouseRight=!1)},l.prototype.mouseMoveEvent=function(t){var e=this.canvas.getBoundingClientRect();this.mouseX=t.clientX-e.left,this.mouseY=t.clientY-e.top},l.prototype.mouseWheelEvent=function(t){return"game"==y.state&&this.playerHandler.wheel(t.wheelDelta?t.wheelDelta:-t.detail),this.mouseX>0&&this.mouseX<this.canvas.width&&this.mouseY>0&&this.mouseY<this.canvas.height?(t.preventDefault(),!1):void 0},a.prototype.init=function(t){this.list.length=0,this.gridList=t.gridHandler.list},a.prototype.enterFrame=function(){for(var t,e,i,o=this.gridList,h=this.list.length-1;h>=0;h--)t=this.list[h],t.x+=t.vX,t.y+=t.vY,t.vY+=.2,t.hp--,e=t.x/y.blockSize|0,i=t.y/y.blockSize|0,e>=0&&e<y.levelWidth&&i>=0&&i<y.levelHeight&&(o[e][i]==y.blockInt.water?(t.x-=.5*t.vX,t.y-=.5*t.vY):o[e][i]!==!1&&o[e][i]!=y.blockInt.cloud&&o[e][i]!=y.blockInt.platform&&(t.hp*=.75)),t.hp<=0&&(this.pool[this.pool.length]=t,this.list.splice(h,1))},a.prototype.create=function(t,e,i,o,h){for(var l=0;h>l;l++){if(this.pool.length>0)var s=this.pool.pop();else var s=new Object;s.x=t,s.y=e,s.vX=i+6*Math.random()-3,s.vY=o+6*Math.random()-3,s.hp=this.startHp,this.list[this.list.length]=s}},n.prototype.init=function(t){this.list.length=0,this.main=t,this.playerHandler=t.playerHandler,this.gridList=t.gridHandler.list,this.blood=t.bloodHandler.create.bind(t.bloodHandler)},n.prototype.enterFrame=function(){var t,e,i,o,h,l,s,a,n,r,d=this.playerHandler,c=this.gridList;e=y.time/y.dayLength,(.25>e||e>.75)&&Math.random()<this.spawnRate&&this.create();for(var p=this.list.length-1;p>=0;p--)if(t=this.list[p],t.hp<=0)this.pool[this.pool.length]=t,this.list.splice(p,1),this.blood(t.x,t.y,0,0,15),this.playerHandler.kills++;else{for(t.canJump<1&&(d.y<t.y-1&&Math.random()<.03||Math.random()<.01)&&(t.vY=-this.jumpHeight),d.x<t.x?(t.vX-=t.accel,t.vX<-t.speed&&(t.vX=-t.speed)):(t.vX+=t.accel,t.vX>t.speed&&(t.vX=t.speed)),a=t.x+t.vX,o=Math.max((a-t.width/2)/y.blockSize|0,0),h=Math.max((t.y-t.height/2)/y.blockSize|0,0),l=Math.min((a+t.width/2-1)/y.blockSize|0,y.levelWidth-1),s=Math.min((t.y+t.height/2)/y.blockSize|0,y.levelHeight-1),e=o;l>=e;e++)for(i=h;s>=i;i++)c[e][i]!==!1&&c[e][i]!=y.blockInt.cloud&&c[e][i]!=y.blockInt.platform&&(c[e][i]==y.blockInt.water?(t.inWater=!0,t.vX>t.speed/2?t.vX=t.speed/2:t.vX<-t.speed/2&&(t.vX=-t.speed/2)):(a=a<e*y.blockSize?e*y.blockSize-t.width/2:e*y.blockSize+y.blockSize+t.width/2,t.vX=0));for(t.x=a,t.inWater?(t.vY+=.25,t.vY>.3*this.fallSpeed&&(t.vY=.3*this.fallSpeed),n=t.y+.6*t.vY):(t.vY+=.4,t.vY>this.fallSpeed&&(t.vY=this.fallSpeed),n=t.y+t.vY),r=!1,t.inWater=!1,o=Math.max((t.x-t.width/2)/y.blockSize|0,0),h=Math.max((n-t.height/2)/y.blockSize|0,0),l=Math.min((t.x+t.width/2-1)/y.blockSize|0,y.levelWidth-1),s=Math.min((n+t.height/2)/y.blockSize|0,y.levelHeight-1),e=o;l>=e;e++)for(i=h;s>=i;i++)c[e][i]!==!1&&c[e][i]!=y.blockInt.cloud&&c[e][i]!=y.blockInt.platform&&(r=!0,c[e][i]==y.blockInt.water?(t.inWater=!0,t.canJump--):(n<i*y.blockSize?(n=i*y.blockSize-t.height/2-.001,t.canJump--):n=i*y.blockSize+y.blockSize+t.height/2,t.vY=0)),c[e][i]==y.blockInt.platform&&t.vY>0&&d.y<t.y-1&&t.y+.5*t.height<i*y.blockSize&&(n=i*y.blockSize-.5*t.height-.001,r=!0,t.vY=0,t.canJump--);t.y=n,0==r&&(t.canJump=this.jumpDelay),t.x-t.width/2<d.x+d.width/2&&t.x+t.width/2>d.x-d.width/2&&t.y-t.height/2<d.y+d.height/2&&t.y+t.height/2>d.y-d.height/2&&(this.blood(t.x,t.y,0,0,5),d.hp--,d.vX+=.05*(d.x-t.x),d.vY+=.05*(d.y-t.y))}},n.prototype.create=function(){if(this.pool.length>0)var t=this.pool.pop();else var t=new Object;this.playerHandler.x<500||Math.random()<.5&&this.playerHandler.x<y.levelWidth*y.blockSize-800?t.x=this.playerHandler.x+500+200*Math.random():t.x=this.playerHandler.x-500-200*Math.random(),t.y=50,t.vX=0,t.vY=10,t.hp=this.startHp,t.accel=this.startAccel,t.speed=this.startSpeed,t.width=this.startWidth,t.height=this.startHeight,t.canJump=0,t.inWater=!1,this.list[this.list.length]=t},d.prototype.init=function(t){this.list=[],this.waterList=[],this.toggle=0;for(var e=0;e<y.levelWidth;e++){this.list[e]=[];for(var i=0;i<y.levelHeight;i++)this.list[e][i]=!1}},d.prototype.enterFrame=function(){for(var t=this.list,e=this.toggle,i=this.waterList.length-1;i>=0;i--)if(e++,e>9&&(e=0),0==e){var o=this.waterList[i];t[o.x][o.y]==y.blockInt.water?o.y<y.levelHeight&&t[o.x][o.y+1]===!1?(t[o.x][o.y+1]=y.blockInt.water,this.waterList[this.waterList.length]={x:o.x,y:o.y+1}):o.x>0&&t[o.x-1][o.y]===!1?(t[o.x-1][o.y]=y.blockInt.water,this.waterList[this.waterList.length]={x:o.x-1,y:o.y}):o.x<y.levelWidth-1&&t[o.x+1][o.y]===!1&&(t[o.x+1][o.y]=y.blockInt.water,this.waterList[this.waterList.length]={x:o.x+1,y:o.y}):this.waterList.splice(i,1)}this.toggle++,this.toggle>9&&(this.toggle=0)},p.prototype.init=function(t){this.controlHandler=t.controlHandler,this.gridHandler=t.gridHandler,this.shoot=t.shotHandler.create.bind(t.shotHandler),this.viewHandler=t.viewHandler,this.enemyHandler=t.enemyHandler,this.halfWidth=t.canvas.width/2,this.halfHeight=t.canvas.height/2,this.x=y.levelWidth*y.blockSize*.5,this.y=10*this.height,this.vX=0,this.vY=20,this.reload=0,this.canJump=0,this.inWater=!1,this.spaceDown=!1,this.hp=this.startHp,this.kills=0,this.action=0,this.canBuild=!1,this.actionObject=this.actions[this.action]},p.prototype.enterFrame=function(){var t,e,i=this.controlHandler,o=this.accel,h=this.speed,l=this.gridHandler.list,s=this.width,a=this.height;this.hp<this.startHp&&(this.hp+=this.regen,this.hp>this.startHp&&(this.hp=this.startHp)),this.canJump<1&&i.space&&0==this.spaceDown&&(this.vY=-this.jumpHeight,this.spaceDown=!0),0==i.space&&this.spaceDown&&(this.spaceDown=!1),i.a?(this.vX-=o,this.vX<-h&&(this.vX=-h)):i.d?(this.vX+=o,this.vX>h&&(this.vX=h)):0!=this.vX&&(this.vX>0?this.vX-=o:this.vX<0&&(this.vX+=o),this.vX>-o&&this.vX<o&&(this.vX=0));var n=this.x+this.vX,r=Math.max((n-.5*s)/y.blockSize|0,0),d=Math.max((this.y-.5*a)/y.blockSize|0,0),c=Math.min((n+.5*s-1)/y.blockSize|0,y.levelWidth-1),p=Math.min((this.y+.5*a)/y.blockSize|0,y.levelHeight-1);for(t=r;c>=t;t++)for(e=d;p>=e;e++)l[t][e]!==!1&&l[t][e]!=y.blockInt.cloud&&l[t][e]!=y.blockInt.platform&&(l[t][e]==y.blockInt.water?(this.inWater=!0,this.vX>.5*h?this.vX=.5*h:this.vX<.5*-h&&(this.vX=.5*-h)):(n=n<t*y.blockSize?t*y.blockSize-.5*s:t*y.blockSize+y.blockSize+.5*s,this.vX=0));if(this.x=n,this.inWater){this.vY+=.25,this.vY>.3*this.fallSpeed&&(this.vY=.3*this.fallSpeed);var v=this.y+.6*this.vY}else{this.vY+=.4,this.vY>this.fallSpeed&&(this.vY=this.fallSpeed);var v=this.y+this.vY}var f=!1;for(this.inWater=!1,r=Math.max((this.x-.5*s)/y.blockSize|0,0),d=Math.max((v-.5*a)/y.blockSize|0,0),c=Math.min((this.x+.5*s-1)/y.blockSize|0,y.levelWidth-1),p=Math.min((v+.5*a)/y.blockSize|0,y.levelHeight-1),t=r;c>=t;t++)for(e=d;p>=e;e++)l[t][e]!==!1&&l[t][e]!=y.blockInt.cloud&&l[t][e]!=y.blockInt.platform&&(f=!0,l[t][e]==y.blockInt.water?(this.inWater=!0,this.canJump--):(v<e*y.blockSize?(v=e*y.blockSize-.5*a-.001,this.canJump--):v=e*y.blockSize+y.blockSize+.5*a,this.vY=0)),l[t][e]==y.blockInt.platform&&this.vY>0&&0==i.s&&this.y+.5*a<e*y.blockSize&&(v=e*y.blockSize-.5*a-.001,f=!0,this.vY=0,this.canJump--);if(this.y=v,0==f&&(this.canJump=this.jumpDelay),this.reload--,this.actionObject.count<0){var m=this.viewHandler.x-this.halfWidth,u=this.viewHandler.y-this.halfHeight,b=i.mouseX+m,g=i.mouseY+u,k=Math.sqrt((this.x-b)*(this.x-b)+(this.y-g)*(this.y-g));if(100>k){if(this.canBuild=!0,this.reload<=0&&i.mouseLeft){if(b=b/y.blockSize|0,g=g/y.blockSize|0,b>0&&b<y.levelWidth&&g>0&&g<y.levelHeight){if(-1==this.actionObject.count&&(0==l[b][g]||l[b][g]==y.blockInt.water||l[b][g]==y.blockInt.cloud)){f=!1;var x;for(t=this.enemyHandler.list.length-1;t>=0;t--)if(x=this.enemyHandler.list[t],x.x+.5*x.width>b*y.blockSize&&x.x-.5*x.width<b*y.blockSize+y.blockSize&x.y+.5*x.height>g*y.blockSize&&x.y-.5*x.height<g*y.blockSize+y.blockSize){f=!0;break}this.x+.5*this.width>b*y.blockSize&&this.x-.5*this.width<b*y.blockSize+y.blockSize&this.y+.5*this.height>g*y.blockSize&&this.y-.5*this.height<g*y.blockSize+y.blockSize&&(f=!0),0==f&&(l[b][g]=this.actionObject.type)}-2==this.actionObject.count&&l[b][g]!=y.blockInt.bedrock&&(l[b][g]=!1)}this.reload=this.actionObject.reload}}else this.canBuild=!1}else if(this.reload<=0&&i.mouseLeft){var m=this.viewHandler.x-this.halfWidth,u=this.viewHandler.y-this.halfHeight;for(t=this.actionObject.count-1;t>=0;t--)this.shoot(this.x,this.y-4,i.mouseX+m,i.mouseY+u,this.actionObject);this.reload=this.actionObject.reload}},p.prototype.hotKey=function(t){48==t&&(t=58),t-49 in this.actions&&(this.action=t-49,this.actionObject=this.actions[this.action],this.reload=this.actions[this.action].reload)},p.prototype.wheel=function(t){t>0?this.action<=0?this.action=this.actions.length-1:this.action--:this.action>=this.actions.length-1?this.action=0:this.action++,this.actionObject=this.actions[this.action],this.reload=this.actions[this.action].reload},v.prototype.init=function(t){this.gridHandler=t.gridHandler,this.controlHandler=t.controlHandler,this.viewHandler=t.viewHandler,this.shotHandler=t.shotHandler,this.dustHandler=t.dustHandler,this.bloodHandler=t.bloodHandler,this.enemyHandler=t.enemyHandler,this.player=t.playerHandler},v.prototype.enterFrame=function(){var t,e,i,o,h,l,s,a=this.context,n=this.gridHandler.list,r=y.blockSize/2,d=this.player,c=d.x,p=d.y;s=y.time*this.timeRatio,o=Math.sin(s),h=Math.cos(s);var v=a.createLinearGradient(0,0,0,this.canvas.height);l=this.viewHandler.y/(y.levelHeight*y.blockSize)*250|0,s=75*(h+1)|0,v.addColorStop(0,"rgb("+(77+l)+","+(117+l)+","+(179+l)+")"),v.addColorStop(1,"rgb("+(127+l-s)+","+(167+l-s)+","+(228+l-s)+")"),a.fillStyle=v,a.fillRect(0,0,this.canvas.width,this.canvas.height),e=.5*this.canvas.width+o*this.sunMoonArcRadius,i=this.canvas.height+h*this.sunMoonArcRadius,a.shadowBlur=40,a.shadowColor="#FEDB16",a.fillStyle="#FEDB16",a.beginPath(),a.arc(e,i,30,0,6.2832),a.fill(),a.closePath(),e=.5*this.canvas.width+-o*this.sunMoonArcRadius,i=this.canvas.height+-h*this.sunMoonArcRadius,a.shadowBlur=20,a.shadowColor="#FFFFFF",a.fillStyle="#FFFFFF",a.beginPath(),a.arc(e,i,30,1.2,4.3416),a.fill(),a.closePath(),a.shadowBlur=0;var f=.5*this.canvas.width-this.viewHandler.x,m=.5*this.canvas.height-this.viewHandler.y;a.fillStyle="#776655",i=Math.round(y.horizon*y.blockSize+m),a.fillRect(0,i,this.canvas.width,this.canvas.height-i);var u=Math.max(-f/y.blockSize|0,0),b=Math.min(u+Math.ceil(this.canvas.width/y.blockSize)+1,y.levelWidth),g=Math.max(-m/y.blockSize|0,0),k=Math.min(g+Math.ceil(this.canvas.height/y.blockSize)+1,y.levelHeight);for(o=u;b>o;o++)for(h=g;k>h;h++)t=n[o][h],t!==!1&&t!=y.blockInt.water&&t!=y.blockInt.cloud&&(e=Math.round(o*y.blockSize+f),i=Math.round(h*y.blockSize+m),a.fillStyle=y.blockColor[t],t==y.blockInt.platform?(a.fillRect(e,i,y.blockSize,.25*y.blockSize),a.fillRect(e,i+.5*y.blockSize,y.blockSize,.25*y.blockSize)):a.fillRect(e,i,y.blockSize,y.blockSize)),t===!1&&h==y.horizon&&n[o][h-1]===!1&&(e=Math.round(o*y.blockSize+f),i=Math.round(h*y.blockSize+m),a.fillStyle="rbga(0,0,0,0.2)",a.fillRect(e+1,i,2,2),a.fillRect(e+5,i,3,3),a.fillRect(e+11,i,2,2));for(e=Math.round(c+f-d.width/2),i=Math.round(p+m-d.height/2),a.shadowBlur=5,a.shadowOffsetX=-d.vX,a.shadowOffsetY=-d.vY,a.shadowColor="rgba(0,0,0,0.1)",a.fillStyle="#333333",a.fillRect(e,i,d.width,d.height),a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0,a.fillStyle="#774444",o=this.enemyHandler.list.length-1;o>=0;o--)t=this.enemyHandler.list[o],a.fillRect(Math.round(t.x+f-.5*t.width),Math.round(t.y+m-.5*t.height),t.width,t.height);for(a.fillStyle="#333333",o=this.shotHandler.list.length-1;o>=0;o--)t=this.shotHandler.list[o],s=this.shotHandler.size,a.fillRect(Math.round(t.x+f-s/2),Math.round(t.y+m-s/2),s,s);for(a.fillStyle="#555555",o=this.dustHandler.list.length-1;o>=0;o--)t=this.dustHandler.list[o],s=this.dustHandler.size*(t.hp/this.dustHandler.startHp),a.fillRect(Math.round(t.x+f-.5*s),Math.round(t.y+m-.5*s),s,s);for(a.fillStyle="#AA4444",o=this.bloodHandler.list.length-1;o>=0;o--)t=this.bloodHandler.list[o],s=this.bloodHandler.size*(t.hp/this.bloodHandler.startHp),a.fillRect(Math.round(t.x+f-.5*s),Math.round(t.y+m-.5*s),s,s);for(o=u;b>o;o++)for(h=g;k>h;h++)t=n[o][h],t==y.blockInt.dirt&&h<=y.horizon&&(n[o][h-1]===!1||n[o][h-1]==y.blockInt.cloud)&&(e=Math.round(o*y.blockSize+f),i=Math.round(h*y.blockSize+m),a.fillStyle="rgba(45,130,45,0.75)",a.fillRect(e,i-3,y.blockSize,3),a.fillRect(e+1,i-5,2,2),a.fillRect(e+5,i-5,3,2),a.fillRect(e+11,i-5,2,2)),t!=y.blockInt.water&&t!=y.blockInt.cloud||(e=Math.round(o*y.blockSize+f),i=Math.round(h*y.blockSize+m),a.fillStyle=y.blockColor[t],a.fillRect(e,i,y.blockSize,y.blockSize)),t==y.blockInt.water&&h<=y.horizon&&(n[o][h-1]===!1||n[o][h-1]==y.blockInt.cloud)&&(a.fillStyle="rgba(255,255,255,0.2)",a.fillRect(e,i,y.blockSize,6),a.fillRect(e,i,y.blockSize/2,3));for(o=u;b>o;o++)for(l=0,h=0;k>h;h++)t=n[o][h],(t!=y.blockInt.bedrock&&t!=y.blockInt.cloud&&0!=t||h>=y.horizon)&&(e=o*y.blockSize,i=h*y.blockSize,s=(c-e-r)*(c-e-r)+(p-i-r)*(p-i-r),e=Math.round(e+f),i=Math.round(i+m),a.fillStyle="rgba(0,0,0,"+.05*l*Math.max(Math.min(s/16e3,1),.4)+")",a.fillRect(e,i,y.blockSize,y.blockSize),l+=t==y.blockInt.platform?.2:t==y.blockInt.water?.5:1);l=Math.min(Math.cos(y.time*this.timeRatio)+.3,.5),l>0&&(a.fillStyle="rgba(0,0,0,"+l+")",a.fillRect(0,0,this.canvas.width,this.canvas.height)),d.actionObject.count<0&&d.canBuild&&(a.fillStyle="rgba(0,0,0,0.2)",a.fillRect(((this.controlHandler.mouseX-f)/y.blockSize|0)*y.blockSize+f,((this.controlHandler.mouseY-m)/y.blockSize|0)*y.blockSize+m,y.blockSize,y.blockSize)),a.fillStyle="#444444",a.fillRect(0,0,this.canvas.width,20),a.textAlign="left",a.font="bold 11px/1 Arial",a.fillStyle="#AAAAAA",a.fillText("H",5,10),a.fillText("K",85,10),a.font="bold 15px/1 Arial",a.fillStyle="#DDDDDD",a.fillText(Math.round(d.hp),15,10),a.fillText(Math.round(d.kills),95,10),a.textAlign="right",a.fillText(d.actions[d.action].name,this.canvas.width-5,10)},f.prototype.init=function(t){this.list.length=0,this.gridList=t.gridHandler.list,this.enemyHandler=t.enemyHandler,this.dust=t.dustHandler.create.bind(t.dustHandler),this.blood=t.bloodHandler.create.bind(t.bloodHandler)},f.prototype.enterFrame=function(){for(var t,e,i,o,h,l=this.gridList,s=this.list.length-1;s>=0;s--){for(t=this.list[s],t.x+=t.vX,t.y+=t.vY,t.vY+=t.modY,t.hp--,o=t.x/y.blockSize|0,h=t.y/y.blockSize|0,o>=0&&o<y.levelWidth&&h>=0&&h<y.levelHeight&&(l[o][h]==y.blockInt.water?(t.x-=.5*t.vX,t.y-=.5*t.vY):l[o][h]!==!1&&l[o][h]!=y.blockInt.cloud&&l[o][h]!=y.blockInt.platform&&(t.destroy&&l[o][h]!=y.blockInt.bedrock&&(l[o][h]=!1),t.hp=-99,this.dust(t.x-t.vX,t.y-t.vY,.2*t.vX,.2*t.vY,4))),i=this.enemyHandler.list.length-1;i>=0;i--)e=this.enemyHandler.list[i],t.x+2>e.x-.5*e.width&&t.x-2<e.x+.5*e.width&&t.y+2>e.y-.5*e.height&&t.y-2<e.y+.5*e.height&&(e.hp-=t.damage,e.vX=.03*t.vX,e.vY=.03*t.vY,t.hp=-99,this.blood(t.x,t.y,.4*t.vX,.4*t.vY,4));if(-99==t.hp&&t.explode>0)for(i=this.actions[t.explode].count-1;i>=0;i--)this.create(t.x,t.y,t.x+10*Math.random()-5,t.y+10*Math.random()-5,this.actions[t.explode]);t.hp<=0&&(this.pool[this.pool.length]=t,this.list.splice(s,1))}},f.prototype.create=function(t,e,i,o,h){if(this.pool.length>0)var l=this.pool.pop();else var l=new Object;l.x=t,l.y=e,l.vX=i-t,l.vY=o-e;var s=Math.sqrt(l.vX*l.vX+l.vY*l.vY);l.vX=l.vX/s*h.speed+Math.random()*h.spread*2-h.spread,l.vY=l.vY/s*h.speed+Math.random()*h.spread*2-h.spread,l.modY=h.modY,l.hp=h.hp,l.explode=h.explode,l.damage=h.damage,l.destroy=h.destroy,this.list[this.list.length]=l},u.prototype.init=function(t){this.x=y.levelWidth*y.blockSize*.5,this.y=300,this.canvas=t.canvas,this.player=t.playerHandler},u.prototype.enterFrame=function(){this.x+=.05*(this.player.x-this.x),this.x<this.player.x+1&&this.x>this.player.x-1&&(this.x=this.player.x),this.y+=.05*(this.player.y-this.y),this.y<this.player.y+1&&this.y>this.player.y-1&&(this.y=this.player.y),this.x<.5*this.canvas.width?this.x=.5*this.canvas.width:this.x>y.levelWidth*y.blockSize-.5*this.canvas.width&&(this.x=y.levelWidth*y.blockSize-.5*this.canvas.width),this.y<.5*this.canvas.height?this.y=.5*this.canvas.height:this.y>y.levelHeight*y.blockSize-.5*this.canvas.height&&(this.y=y.levelHeight*y.blockSize-.5*this.canvas.height)}},{}]},{},[1]);